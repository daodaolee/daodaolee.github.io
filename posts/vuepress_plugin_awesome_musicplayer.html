<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一款vuepress的音乐可视化播放插件</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/assets/style.b4de4daf.css">
    <link rel="modulepreload" href="/assets/chunks/Home.84031245.js">
    <link rel="modulepreload" href="/assets/chunks/Navbar.7a2e2f08.js">
    <link rel="modulepreload" href="/assets/chunks/Page.298bf9fa.js">
    <link rel="modulepreload" href="/assets/chunks/Post.8123d9ef.js">
    <link rel="modulepreload" href="/assets/chunks/Movie.e7531bdd.js">
    <link rel="modulepreload" href="/assets/app.ec7a89e7.js">
    <link rel="modulepreload" href="/assets/posts_vuepress_plugin_awesome_musicplayer.md.8c0097a3.lean.js">
    
    <link rel="icon" href="/favicon.ico">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><div><header class="w-100vw p-6 flex items-center justify-between fixed" data-v-29c3ee47><a href="/" data-v-29c3ee47><img src="/logo-black.webp" class="w-10 h-10" data-v-29c3ee47></a><div class="nav-icons flex items-center gap-5" data-v-29c3ee47><!--[--><a target="_self" href="/posts/" class="cursor-pointer op-60 transition-colors-300" data-v-29c3ee47><div text-xl class="md:hidden" data-v-29c3ee47><div class="i-ri-article-line icon" data-v-29c3ee47></div></div><span text-sm ml-1 class="lt-md:hidden" data-v-29c3ee47>Posts</span></a><a target="_self" href="/movies/" class="lt-md:hidden cursor-pointer op-60 transition-colors-300" data-v-29c3ee47><!----><span text-sm ml-1 class="lt-md:hidden" data-v-29c3ee47>Movies</span></a><a target="_blank" href="https://github.com/daodaolee" class="lt-md:hidden cursor-pointer op-60 transition-colors-300" data-v-29c3ee47><div text-xl class="" data-v-29c3ee47><div class="i-ri:github-line icon" data-v-29c3ee47></div></div><!----></a><a target="_blank" href="https://twitter.com/daodaolee_" class="lt-md:hidden cursor-pointer op-60 transition-colors-300" data-v-29c3ee47><div text-xl class="" data-v-29c3ee47><div class="i-ri:twitter-line icon" data-v-29c3ee47></div></div><!----></a><a target="_blank" href="https://www.instagram.com/daodaoleee/" class="lt-md:hidden cursor-pointer op-60 transition-colors-300" data-v-29c3ee47><div text-xl class="" data-v-29c3ee47><div class="i-ri-instagram-line icon" data-v-29c3ee47></div></div><!----></a><a target="_blank" href="https://dribbble.com/daodaolee" class="lt-md:hidden cursor-pointer op-60 transition-colors-300" data-v-29c3ee47><div text-xl class="" data-v-29c3ee47><div class="i-ri-dribbble-line icon" data-v-29c3ee47></div></div><!----></a><a target="_blank" href="https://space.bilibili.com/294106298?spm_id_from=333.1007.0.0" class="lt-md:hidden cursor-pointer op-60 transition-colors-300" data-v-29c3ee47><div text-xl class="" data-v-29c3ee47><div class="i-ri-bilibili-fill icon" data-v-29c3ee47></div></div><!----></a><!--]--><a class="cursor-pointer op-60" data-v-29c3ee47><div class="i-ri:sun-line icon" data-v-29c3ee47></div></a></div></header><main class="content max-w-73ch mx-auto px-6 md:px-0 pb-15"><div class="pt-25"><div class="mb-8"><h1 class="title mt-0 text-2.2rem mb-5">一款vuepress的音乐可视化播放插件</h1><div class="op-60 flex items-end"><span>Dec 26, 2021</span><div class="text-0.85rem pl-1.8rem"><!--[--><span> #webAudio  </span><!--]--></div></div></div><div style="position:relative;" class="page"><div><nav class="table-of-contents"><ul><li><a href="#前言">前言</a></li><li><a href="#开搞">开搞</a></li><li><a href="#优化">优化</a></li><li><a href="#遇到的问题">遇到的问题</a><ul><li><a href="#npm-link">npm link</a></li><li><a href="#接口">接口</a></li><li><a href="#主题色">主题色</a></li></ul></li><li><a href="#结尾">结尾</a></li></ul></nav><p>体验地址：<a href="https://github.com/daodaolee/vuepress-plugin-awesome-musicplayer" target="_blank" rel="noreferrer">github</a>，<a href="https://www.npmjs.com/package/vuepress-plugin-awesome-musicplayer" target="_blank" rel="noreferrer">npm</a></p><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-hidden="true">#</a></h2><p>博客上的音乐播放器，大多都长一个样，小小的，塞在页面的一个角落里，在别人阅读文章的同时可以听音乐，增加某些体验的满意指数。而我，做了一件不太一样的事情：</p><p>博客不就是让人看文章的么？再播放音乐甚至有可能会降低阅读的质量，那听歌就好好听歌不好么？<strong>既然要体验，那就沉浸体验到爽不好么？</strong></p><p><img src="https://cdn.jsdelivr.net/gh/daodaolee/photobed@main/img/20211226165507.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/daodaolee/photobed@main/img/20211226165508.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/daodaolee/photobed@main/img/20211226165506.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/daodaolee/photobed@main/img/20211226165509.png" alt=""></p><p>某天，偶然打开了豆瓣FM网页版，很符合豆瓣的感觉，干净简洁，当然网上类似的音乐播放有很多，这里为我后面做的事情埋下了伏笔。</p><p>我博客是用 <a href="./.html">vuepress</a> 搭建的，主题是 <a href="https://vuepress-theme-reco.recoluan.com/views/1.x/" target="_blank" rel="noreferrer">vuepress-reco</a>，最开始想找一个播放音乐的插件，于是去找了 <a href="https://github.com/vuepress/awesome-vuepress" target="_blank" rel="noreferrer">awesome-vuepress</a>，搜到唯一和音乐相关的插件，只有一个叫：<a href="https://github.com/PentaTea/B-Tree.studio/tree/master/docs/.vuepress/plugin/vuepress-plugin-music-bar#vuepress-plugin-music-bar" target="_blank" rel="noreferrer">vuepress-plugin-music-bar</a> 的插件.....还是个bar....有点失落。于是，没人做？那...我做个试试？最终的效果图就是上面看到的四张图了：亮/暗系歌词，亮暗系可视化解码。在看完 <code>vuepress</code> 官网的插件api，就开始搞了！</p><h2 id="开搞" tabindex="-1">开搞 <a class="header-anchor" href="#开搞" aria-hidden="true">#</a></h2><p>不管怎么画页面，初衷是沉浸式体验，找了很多播放器的大体结构，还是觉得网易云的播放界面算比较舒服的，自己也有尝试画过脑海里的播放界面，但是最终还是选择用网易云的效果（拿来吧你）：左侧黑胶唱片滚动，右侧歌词滚动， 目前不需要上一曲下一曲，就有播放和分享按钮，也就是长这个样子：</p><p><img src="https://cdn.jsdelivr.net/gh/daodaolee/photobed@main/img/20211223183444.png" alt=""></p><p>一天半时间，匆匆忙忙做完之后，<code>npm link</code> 调试成功就发了一版npm包。好用？不好说。能不能用？能！</p><h2 id="优化" tabindex="-1">优化 <a class="header-anchor" href="#优化" aria-hidden="true">#</a></h2><p>做到这里之后，沉浸式有那么点感觉了，体验？照搬过来就是好的体验么？不，还是要加点东西，比如<strong>可视化</strong>。</p><p>这里特别感谢网易云大前端团队的一篇文章：<a href="https://juejin.cn/post/6844903953130323976" target="_blank" rel="noreferrer">Web Audio在音频可视化中的应用</a>，基本上照着看下来，里面的文献也看一下，就可以做出来上面的效果。说实话，文献是真头大....波长，正余弦，频域时域，奈奎斯特定理，还有什么快速傅里叶变换，头发在偷偷的掉...顺便附上一张某个文献的截图：</p><p><img src="https://cdn.jsdelivr.net/gh/daodaolee/photobed@main/img/20211226171755.jpg" alt=""></p><p>不过不看这些也可以做出来！</p><p>基本上的思路就是：</p><ol><li>创建 <code>AudioContext</code>，关联音频输入，进行解码、控制音频播放和暂停</li><li>创建 <code>analyser</code> ，获取音频的频率数据（FrequencyData）和时域数据（TimeDomainData）</li><li>设置快速傅里叶变换值，信号样本的窗口大小，区间为32-32768，默认2048</li><li>创建音频源，音频源关联到分析器，分析器关联到输出设备（耳机、扬声器等）</li><li>获取频率数组，转格式，然后用 <code>requestAnimationFrame</code> 通过 <code>canvas</code> 画出来</li></ol><p>这些东西上面的文章里讲的很详细，我这种门外汉就不多说啥了。</p><h2 id="遇到的问题" tabindex="-1">遇到的问题 <a class="header-anchor" href="#遇到的问题" aria-hidden="true">#</a></h2><h3 id="npm-link" tabindex="-1">npm link <a class="header-anchor" href="#npm-link" aria-hidden="true">#</a></h3><p>之前使用 <code>npm link</code> 的时候，依赖包没有三方/四方的依赖，所以没注意到，如果开发的npm包带有别的依赖，那么调试的时候要在主项目里的 <code>package.json</code> 先加上这些包，就不会报错说 <code>resolve</code> 失败什么的了，调试结束记得 <code>npm unlink</code> 断开。</p><h3 id="接口" tabindex="-1">接口 <a class="header-anchor" href="#接口" aria-hidden="true">#</a></h3><p>本来想用的是 <a href="https://binaryify.github.io/NeteaseCloudMusicApi/#/" target="_blank" rel="noreferrer">网易云音乐 NodeJS 版 API</a>，但是有些东西不好找，比如我需要歌曲id，封面和歌词，但是文档里没有歌曲id反查专辑id的（封面在专辑id里），只有一个歌曲详情的，但是这个接口，还需要认证跳转....对于使用者来说，我没必要让使用者多这么一步操作，而且很容易出错。于是就换了一个api：<a href="https://api.paugram.com/help/netease" target="_blank" rel="noreferrer">保罗API</a>，这个API可以解析的网易云歌曲不是那么的多，不过一般的够了，唯一的缺点就是，多频次刷新会一直 <code>pending</code>，应该是后端设置了ip频次。</p><p>既然都有问题，不使用接口行么？尝试找一种 mp3 文件解析出来歌词和封面呢？找到一个 <a href="https://github.com/aadsm/jsmediatags" target="_blank" rel="noreferrer">jsmediatags</a> 的仓库，可以解析ID3v2，MP4，FLAC等字段，但是.....这不就是给用户添加麻烦么？需要找专辑，歌词，歌曲，艺人信息全部合一的音源文件....如果我是用户，我不会用它。</p><p>翻来覆去，最终还是决定，歌曲用户传进来，然后再传一个歌曲id，封面和歌词走接口，歌曲就是传进来的音源链接，使用方法如下：</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#666666;">&lt;</span><span style="color:#FDAEB7;">MusicPlayer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">musicId</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">xxx</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">musicSrc</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">xxx.mp3</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">style</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">margin:0 auto</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">&gt;</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#999999;">&lt;</span><span style="color:#B31D28;">MusicPlayer</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">musicId</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">xxx</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">musicSrc</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">xxx.mp3</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">style</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">margin:0 auto</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>音源我个人建议要么放vuepress的静态资源，要么就搞成类似图床一样的音源仓库，这样也好维护。</p><p>后期想办法优化吧。</p><h3 id="主题色" tabindex="-1">主题色 <a class="header-anchor" href="#主题色" aria-hidden="true">#</a></h3><p>亮系和暗系是适配 <a href="https://vuepress-theme-reco.recoluan.com/views/1.x/" target="_blank" rel="noreferrer">vuepress-reco</a> 的主题切换做的适配。</p><h2 id="结尾" tabindex="-1">结尾 <a class="header-anchor" href="#结尾" aria-hidden="true">#</a></h2><p>灵感来自 <a href="https://fm.douban.com/?from_=shire_top_nav" target="_blank" rel="noreferrer">豆瓣FM</a>，结构参考了昊神的 <a href="https://github.com/sl1673495/vue-netease-music" target="_blank" rel="noreferrer">音乐播放器</a>，可视化播放参考了 <a href="https://juejin.cn/post/6844903953130323976" target="_blank" rel="noreferrer">Web Audio在音频可视化中的应用</a>，接口感谢 <a href="https://api.paugram.com/help/netease" target="_blank" rel="noreferrer">保罗API</a>，这么一说我好像也没做什么事.....</p><p>该插件已发npm包，<a href="https://github.com/vuepress/awesome-vuepress" target="_blank" rel="noreferrer">awesome-vuepress</a> 仓库也已收录，可能多少还会有点体验上的小问题，会慢慢修复的。大家也可以提建议，能听进去算我输！</p><p>项目写的匆匆忙忙......</p></div></div></div></main></div></div><div class="text-center text-[14px] pt-10 pb-2 scale-80 color-[black]" style="letter-spacing:0.2rem;"><a href="https://beian.miit.gov.cn/">浙ICP备2022027583号</a></div><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"78f3a6e0\",\"movies_index.md\":\"6d564773\",\"posts_async.md\":\"c7940291\",\"posts_chrome_workflow.md\":\"dfdcf7cb\",\"posts_csp.md\":\"8b1e0799\",\"posts_eventloop.md\":\"c6caf8e8\",\"posts_form.md\":\"3add2ce3\",\"posts_friends_of_time_2023.md\":\"71b69490\",\"posts_git.md\":\"c90465ed\",\"posts_http_option.md\":\"9997527c\",\"posts_index.md\":\"279f248e\",\"posts_promise_next.md\":\"58ff639f\",\"posts_promise_prev.md\":\"4ddfbc45\",\"posts_rebuild_mac.md\":\"1be3b152\",\"posts_refactor_js.md\":\"76f8eb20\",\"posts_render_on_the_web.md\":\"0b11ff2c\",\"posts_restudy_function.md\":\"34c408f6\",\"posts_restudy_obj.md\":\"2fb56604\",\"posts_restudy_scope.md\":\"de7f7b3d\",\"posts_sourcemap.md\":\"259901c9\",\"posts_summary_2011.md\":\"ac21b29a\",\"posts_svg.md\":\"60324705\",\"posts_translate.md\":\"4dddf28e\",\"posts_vscode_setting.md\":\"26038331\",\"posts_vuepress_plugin_awesome_musicplayer.md\":\"8c0097a3\",\"posts_webpack_core.md\":\"d6397305\"}")</script>
    <script type="module" async src="/assets/app.ec7a89e7.js"></script>
    
  </body>
</html>